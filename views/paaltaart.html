{% extends 'template.html' %}

{% block title %}
	{{ pagename }}
{% endblock %}

{% block content %}
<link href="/css/paaltaart.css" rel="stylesheet">
<h2>{{ pagename }}</h2>
<div class="panel panel-default">
	<!-- <form method="post" id="formalta" action="/paaltaart"> -->
		<input hidden name="aArt" id="aArt" value="{{ articulos }}">
		<table align="center" class="table table-striped">
			<tr>
				<td>Articulo</td>
				<td>
					<select class="form-control" id="articulo" name="articulo">
						{% for a in articulos %}
							<option value="{{ a.id }}">{{ a.Nombre }}</option>
						{% endfor %}
					</select>	
				</td>
			</tr>
			<tr>
				<td>Cantidad:</td>
				<td><input type="text" id="cantidad" name="cantidad" required onkeyup="checkInput(this)" class="form-control"></td>
			</tr>
			<tr>
				<td>Fecha Necesidad:</td>
				<td><input id="fecha_necesidad" name="fecha_necesidad" class="datepicker form-control" readonly></td>
			</tr>
			<tr>
				<td>Responsable:</td>
				<td>	
					<select class="form-control" id="responsable" name="responsable">
						{% for e in emples %}
							<option value="{{ e.id }}">{{ e.nombre }}</option>
						{% endfor %}
					</select>
				</td>
			</tr>
			<tr>
				<td>Centro de Costos:</td>
				<td>	
					<select class="form-control" id="centrocosto" name="centrocosto">
						{% for c in centros %}
							<option value="{{ c.id }}">{{ c.nombre }}</option>
						{% endfor %}
					</select>
				</td>
			</tr>
			<tr>
				<td>Urgente:</td>
				<td>
					<select class="form-control" id="urgente" name="urgente">
						<option value="0">No</option>
						<option value="1">Si</option>
					</select>
				</td>
			</tr>
			<tr>
				<td><input type="button" value="Atras" onclick="history.back()"></td>
				<td><input type="button" id="btnAgregar" value="Agregar"></td>
			</tr>
		</table>
	<!-- </form> -->
</div>
<script src="/js/jquery.min.js"></script>
<script src="/js/bootstrap-datepicker.js"></script>
<script type="text/javascript">
	function checkInput(ob) {
	  	var invalidChars = /[^0-9]/gi
	  	if(invalidChars.test(ob.value)) {
	        ob.value = ob.value.replace(invalidChars,"");
	    }
	}

	$(function() {
		var objDatos = localStorage.getItem('objDatos');
		console.log(objDatos);


		$("#btnAgregar").on("click", function(){
			console.log("dentro de agregar")
			var id_articulo = $("#articulo").val();
			var txtarticulo = $('#articulo option:selected').text();
			var cantidad = $("#cantidad").val();
			var fecha_necesidad = $("#fecha_necesidad").val();
			var id_responsable = $("#responsable").val();
			var txtresponsable = $('#responsable option:selected').text();
			var id_centro_costo = $("#centrocosto").val();
			var txtcentrodecosto = $('#centrocosto option:selected').text();
			var urgente = $("#urgente").val();
			
			objArt = {
				'id_articulo_fk': id_articulo,
				'txtarticulo': txtarticulo,
				'cantidad': cantidad,
				'fecha_necesidad': fecha_necesidad,
				'id_responsable_fk': id_responsable,
				'txtresponsable': txtresponsable,
				'id_centrocosto_fk': id_centro_costo,
				'txtcentrodecosto': txtcentrodecosto,
				'urgente': urgente
			}
			
			console.log("obj creado..");
			console.log(objArt);

			// var storage = localStorage;
			var objDatos = localStorage.getItem('objDatos');
			// console.log(aArticulos);
			objDatos_parseado = JSON.parse(objDatos);
			console.log("objDatos_parseado");
			console.log(objDatos_parseado);

			aArt = objDatos_parseado.aArticulos;
			console.log("art guardado");
			console.log("aArt.length: "+aArt.length);

			// if (aArt.length == 0){
			aArt.push(objArt);
			console.log("obj pusheado..");
			// }else{
			// 	console.log("length mayor a 0")
			// }

			objDatos_stringified = JSON.stringify(objDatos_parseado);

			localStorage.objDatos = objDatos_stringified

			// aArticulos2.push(objArt);
			
			// localStorage.aArticulos = JSON.stringify(aArticulos);
			
			window.location = '/paalta';
		});
	});

	$(".datepicker").datepicker({
		format: 'dd/mm/yyyy',
		autoclose: true,
		language: 'ES'
	});
</script>

{% endblock %}